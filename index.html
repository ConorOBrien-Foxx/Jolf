<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Jolf</title>
	<meta http-equiv="X-UA-Compatible" content="chrome=1">
	<meta name="description" content="Jolf : A golfier prefix version of JavaScript">
	<link rel="stylesheet" href="bootstrap.css">
	<script src="https://rawgit.com/Ed-von-Schleck/shoco/master/shoco.js"></script>
	<script src="https://rawgit.com/gf3/Levenshtein/master/lib/levenshtein.js"></script>
	<script src="https://rawgit.com/mathiasbynens/utf8.js/master/utf8.js"></script>
	<script src="https://rawgit.com/davebalmer/turtlewax/master/pen.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/2.5.0/math.min.js"></script>
	<script src="https://rawgit.com/pieroxy/lz-string/master/libs/lz-string.min.js"></script>
	<script src="https://raw.githubusercontent.com/ConorOBrien-Foxx/WordList-JS/master/src/wordRaw.js"></script>
	<script src="https://rawgit.com/ConorOBrien-Foxx/Jolf/master/src/jolf.js"></script>
	<script>
	// from tryitonline.net
	function load(){
		if(location.hash){
			var hash = location.hash.slice(1).split("&").map(function(r){
				r=r.split("=");
				if(r[0]=="code") document.getElementById("code").value = decode(r[1]);
				if(r[0]=="input") document.getElementById("input").value = decode(r[1]);
			});
		}
	}

	function save(){
		var a = document.getElementById("code").value;
		var b = document.getElementById("input").value;
		location.hash = "#"+
						[a?"code="+encode(a):"",
						b?"input="+encode(b):""].filter(function(x){return x}).join("&");
	}

	function encode(string) {
		return btoa(unescape(encodeURIComponent(string))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_");
	}

	function decode(string) {
		return decodeURIComponent(escape(atob(unescape(string).replace(/-/g, "+").replace(/_/g, "/"))));
	}

	// end from tryitonline.net

	var progs = {
		"Hello World (1)": "\"Hello, World!",
		"Hello World (2)": "e.$nsp$`0\b4",
		"Adding two inputs": "+Jj"
	};

	var nsp = [];
	var keyz = Object.keys(progs);
	for(var i=0;i<keyz.length;i++){
		nsp.push(progs[keyz[i]]);
	}

	function run(ex){
		document.getElementById("code").value = progs[ex];
	}

	function updateByteCount(){
		var modul = isValidISO88597(document.getElementById("code").value)&&isValidISO88597(document.getElementById("prec").value)?{encode:function(x){return x}}:utf8;
		var a = modul.encode(document.getElementById("code").value).length;
		var b = modul.encode(document.getElementById("prec").value).length
		document.getElementById("bytes").innerHTML = b+" + "+a+(a&&b?" + 1":"")+" = "+(a+b+(a&&b));
	}

	function onEdit(){
		document.getElementById("code").value = document.getElementById("code").value.replace(/\\b/g,"\b").replace(/\\n/g,"\n").replace(/\\f/g,"\f").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\x(..)/g,function(m,p1){return eval("\"\\x"+p1+"\"")}).replace(/\\u(.{4})/g,function(m,p1){return eval("\"\\u"+p1+"\"")});
		updateByteCount();
	}

	function addListeners(){
		document.getElementById("code").addEventListener("change",updateByteCount);
		document.getElementById("code").addEventListener("keydown",updateByteCount);
		document.getElementById("code").addEventListener("keyup",updateByteCount);
		document.getElementById("prec").addEventListener("change",updateByteCount);
		document.getElementById("prec").addEventListener("keydown",updateByteCount);
		document.getElementById("prec").addEventListener("keyup",updateByteCount);
		document.getElementById("uploadISOGREEK").addEventListener("click",function(){
			var fr=new FileReader();fr.onload=function(){document.getElementById("code").value=convertFrom1to7(fr.result)};fr.readAsBinaryString(document.getElementById("isogreek").files[0]);
			updateByteCount();
		});
		var qS = document.querySelectorAll("#openMenu + div#inner button");
		for(var i=0;i<qS.length;i++){
			qS[i].addEventListener("click",function(){
				document.getElementById("code").value = progs[this.innerHTML] || "XError: program not found";
			});
		}
		document.getElementById("save").addEventListener("click",save);
		document.getElementById("load").addEventListener("click",load);
		document.getElementById("openMenu").addEventListener("click",function(e){
			var inner = document.getElementById("inner");
			inner.style.height = inner.style.height!="auto"?"auto":"0px";
		});
		document.getElementById("run").addEventListener("click",function(){
			var x = new Jolf(document.getElementById("code").value);
			while(x.step());
			var o;
			try {
				o = x.readable();
			} catch(e){
				o = x.total;
			}
			o+="<hr>"+x.explanation("  ");
			document.getElementById("outCode").innerHTML = o;
			try {
				x.exec();
			} catch(e){
				var error = document.getElementById("error");
				error.innerHTML += e + "<br>";
			}
		});
		document.getElementById("runnn").addEventListener("click",function(){
			var x = new Jolf(document.getElementById("code").value);
			while(x.step());
			var o;
			try {
				o = x.readable();
			} catch(e){
				o = x.total;
			}
			o+="<hr>"+x.explanation("  ");
			document.getElementById("outCode").innerHTML = o;
			document.getElementById("input").value.split("\n\n").forEach(function(e,i){
				document.getElementById("output").innerHTML += "--- TEST CASE "+i+": "+e+" ---<br>";
				x.exec();
				document.getElementById("output").innerHTML += "<br>";
			});
		});
		document.getElementById("transform").addEventListener("click",onEdit);
		document.getElementById("insert").addEventListener("click",function(){
			var toIns = document.getElementById("toIns");
			toIns.style.display = toIns.style.display==="block"?"none":"block";
			if(!toIns.innerHTML.has("button")){
				toIns.innerHTML = "";
				jolf("~ ").replace(/\xad/,"$&\xaeQ!").replace(/ÏŽ/,"$&\xffQ!").match(/.Q!|[\s\S]/g).forEach(function(e,i){
					var c = jolf("@"+e);
					var bu = document.createElement("button");
					bu.className = "insertChar";
					bu.appendChild(document.createTextNode(visible(e[0],/Q!/.test(e))));
					bu.addEventListener("click",function(){
						var x = document.getElementById("code").value.split("");
						x.splice(code.selectionStart, code.selectionEnd - code.selectionStart, this.innerHTML.replace(/\\b/g,"\b").replace(/\\n/g,"\n").replace(/\\f/g,"\f").replace(/\\r/g,"\r").replace(/\\t/g,"\t").replace(/\\x(..)/g,function(m,p1){return eval("\"\\x"+p1+"\"")}).replace(/\\u(.{4})/g,function(m,p1){return eval("\"\\u"+p1+"\"")}));
						document.getElementById("code").value = x.join("");
						updateByteCount();
					});

					if(c%16===0&&c){toIns.appendChild(document.createElement("br"));}
					toIns.appendChild(bu)
				});
			}
		});
		document.getElementById("clear").addEventListener("click",function(){document.getElementById("output").innerHTML = "";});
		document.getElementById("clearError").addEventListener("click",function(){document.getElementById("error").innerHTML = "";});
		updateByteCount();
	}

	window.addEventListener("load",load);
	window.addEventListener("load",addListeners);
	</script>
	<link rel="STYLESHEET" href="Jolf.css">
</head>
<body>
<div id="container">
	<header>
		<h1 id="title">Jolf</h1>
		<button class="btn btn-success" id="save">save</button>
		<button class="btn btn-warning" id="load">load</button>
		<div id="menu">
			<button class="btn btn-info" id="openMenu">
				examples
			</button>
			<div id="inner">
				<ul>
					<li><button class="btn btn-info">Hello World (1)</button></li>
					<li><button class="btn btn-info">Hello World (2)</button></li>
					<li><button class="btn btn-info">Adding two inputs</button></li>
				</ul>
			</div>
		</div>
		<button class="btn btn-danger" id="insert">insert character</button>
		<a target="_blank" href="http://github.com/ConorOBrien-Foxx/Jolf/">github</a> || <a href="explanation.html">explanation</a> || <a href="command.html">command line</a>
	</header>
	<div id="main">
		<div id="toIns">If you see this, something has gone wrong.</div>
		<button class="btn btn-block btn-primary sev" id="run">
			Run (runs the program once)
		</button>
		<table>
			<tr><td class="lrg" colspan="2">(bytes: <span id="bytes">0</span>)</td><td></td></tr>
			<tr><td>Precompile</td><td>Code</td></tr>
			<tr><td><textarea id="prec" spellcheck="false"></textarea></td><td><textarea id="code" spellcheck="false"></textarea></td></tr>
			<tr><td colspan="2"></td></tr>
			<tr><td colspan="2"></td></tr>
		</table>
		<button id="transform" class="btn btn-info sev">apply transformation of code</button>
		<p>Input</p>
		<p>Input is seperated by a double newline (<code>\n\n</code>).</p>
		<textarea id="input" spellcheck="false"></textarea>
		<button class="btn btn-block btn-warning sev" id="runnn">Full Run (runs the program once for each input)</button>
		<p>Output</p>
		<div id="output"></div>
		<button id="clear" class="btn btn-block btn-info sev">clear</button>
		<p>Error</P>
		<div id="error"></div>
		<button id="clearError"class="btn btn-block btn-warning sev">clear</button>
		<p>Transpiled code</p>
		<div id="outCode"></div>
		<p>Canvas output</p>
		<canvas id="draw"><b>Sorry! It seems that your browser does not support canvas. :( Maybe try <a href="https://www.mozilla.org/en-US/firefox/new/">Firefox</a>? <sub>better than IE and Chrome</sub></b></canvas>
		<br><button id="uploadISOGREEK">Upload as an ISO 8859-7-encoded file</button><input type="file" id="isogreek">
	</div><div id="options">
		<h2>Options</h2>
		<input type="checkbox" id="pom"> Pretty output mode?
	</div>
</div>
</body>
</html>
